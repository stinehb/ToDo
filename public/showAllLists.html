<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TestClient</title>
  </head>
  <body>
    <!----------- HTML-elements -------------->
    <br />
    <button id="btnCreate">Make new to do list!</button>
    <div id="container"></div>

    <a href="index.html">Return to Login!</a>

    <!------------- JavaScript --------------->
    <script>
      let btn = document.getElementById("btnCreate");
      let container = document.getElementById("container");

      //-----------------------------------------------

      btn.addEventListener("click", async function (evt) {
        let url = "/createNewList";
        let token = localStorage.getItem("token");
        window.location.href = "createToDoList.html";
      });

      async function showAllLists() {
        let url = "/showAllLists";
        let token = localStorage.getItem("token");

        let cfg = {
          method: "GET",
          headers: {
            "content-type": "application/json",
            "authorization": token,
          },
        };

        try {
          let response = await fetch(url, cfg);
          let data = await response.json();

          if (response.status != 200) {
            throw data.error;
          }

          container.innerHTML = ""; //delete previous content

          for (let value of data) {
            let date = new Date(value.date);

            let html = "<h2>" + value.heading + "</h2>";
            html += "<p>" + date.toLocaleDateString() + "</p>";
            //html += "<p>" + value.item + "</p><hr>";

            let div = document.createElement("div");
            div.innerHTML = html;
            //console.log(value.updata.content);

            div.addEventListener("click", function (evt) {
              let url = "/showToDoList";
              let divContent = localStorage.setItem(
                "divContent",
                value.items
              );
              let divHeading = localStorage.setItem(
                "divHeading",
                value.heading
              );
              let divID = localStorage.setItem("divID", value.id);
              window.location.href = "showToDoList.html";
            });
            container.appendChild(div);

            /* let delbtn = document.createElement("button");
                    delbtn.innerHTML = "Delete";

                    delbtn.addEventListener('click', function(evt) {
                        deleteLists(value.id);
                    });

                    div.insertBefore(delbtn, div.lastElementChild); */
          }
        } catch (error) {
          console.log(error);
        }
      }

      //-----------------------------------------------
      async function deleteLists(todoID) {
        let url = "/showAllLists";

        //let url = "/showAllLists?listeid=" + variabel;

        let updata = {
          id: todoID,
        };

        let cfg = {
          method: "DELETE",
          headers: { "content-type": "application/json" },
          body: JSON.stringify(updata),
        };

        try {
          let response = await fetch(url, cfg);
          let data = await response.json();

          if (response.status != 200) {
            throw data.error;
          }

          showAllLists(); //refresh the list
        } catch (error) {
          console.log(error);
        }
      }

      // start ----------------------------------------
      showAllLists();
    </script>

    <!---------------- CSS ------------------->
    <style>
      * {
        text-align: center;
        margin: 0;
        font-family: sans-serif;
        background-color: rgb(163, 155, 144);
        color: rgb(9, 15, 12);
      }
      button {
        background-color: rgb(126, 121, 121);
      }
      div:hover {
        background-color: paleturquoise;
        cursor: pointer;
      }
    </style>
  </body>
</html>
