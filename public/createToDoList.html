<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ToDoList</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!----------- HTML-elements -------------->
  <h1>Create a New To Do List</h1>


  <input id="listTitle" type="text" placeholder="List Title" />
  <br />
  <input id="input" type="text" placeholder="Add text" />
  <button id="newCheckbox" class="button">Add New</button> <br>
  <div id="container"></div>

  <label for="remember">Check the box if you want the list to be public to all users</label>
  <input id="checkboxShare" name="checkboxShare" type="checkbox" /> <br> <br>

  <button id="sendToServer" class="button">Save the List</button>
  <button id="btnShowAllLists" class="button">Show All Lists</button>

  <!------------- JavaScript --------------->
  <script>
    let listTitle = document.getElementById("listTitle");
    let input = document.getElementById("input");
    let newCheckboxBtn = document.getElementById("newCheckbox");
    let sendToServer = document.getElementById("sendToServer");
    let deleteItem = document.getElementById("deleteItem");
    let container = document.getElementById("container");
    let btnShowAllLists = document.getElementById("btnShowAllLists");
    let checkboxShare = document.getElementById("checkboxShare");
    let items = [];
    let itemNmbr = 1;

    function privateOrPublic() {
      if (checkboxShare.checked) {
        checkboxShare = 1;
        console.log(checkboxShare);
      } else {
        checkboxShare = 0;
        console.log(checkboxShare);
      }
    }

    newCheckboxBtn.addEventListener("click", async function (evt) {
      let listItem = document.createElement("h2");
      listItem.innerHTML = `${itemNmbr}. ${input.value}`;
      itemNmbr++;
      container.appendChild(listItem);

      let todo = {
        text: input.value,
        id: Date.now(),
      };

      if (input.value.length > 0) {
        items.push(todo);
      }
      input.value = "";
    });

    sendToServer.addEventListener("click", async function (evt) {

      privateOrPublic() 
      let url = "/createNewList";
      let token = localStorage.getItem("token");

      let updata = {
        heading: listTitle.value,
        content: JSON.stringify(items),
        public: checkboxShare
      };

      let cfg = {
        method: "POST",
        headers: {
          "content-type": "application/json",
          "authorization": token
        },
        body: JSON.stringify(updata)
      };

      try {
        let response = await fetch(url, cfg);
        let data = await response.json();

        if (response.status != 200) {
          throw data.error;
        }

        window.location.href = "showAllLists.html";

      } catch (error) {
        console.log(error);
      }
    });

    btnShowAllLists.addEventListener("click", function (evt) {
      location.href = "showAllLists.html";
    });
  </script>

</body>

</html>