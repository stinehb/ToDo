<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Show Specific To Do List</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!----------- HTML-elements -------------->

  <h1 id="title"></h1><br>
  <div id="container" class="listContainer"></div>
  <input id="inp" type="text">
  <button id="btnNewItem" class="button">Add an Item</button>
  <br>

  <button id="saveBtn" class="button">Save the List</button>
  <button id="btnShowAllLists" class="button">Show All Lists</button>

  <!------------- JavaScript --------------->
  <script>

    let container = document.getElementById("container");
    let title = document.getElementById("title");
    let inp = document.getElementById("inp");
    let btnNewItem = document.getElementById("btnNewItem");
    let btnShowAllLists = document.getElementById("btnShowAllLists");
    let saveBtn = document.getElementById("saveBtn");

    let divHeading = localStorage.getItem("divHeading");
    let divID = localStorage.getItem("divID");
    let divContent = localStorage.getItem("divContent");
    contentArr = JSON.parse(divContent);

    btnNewItem.addEventListener("click", async function () {

      let todo = {
        text: inp.value,
        id: Date.now(),
      };

      contentArr.push(todo);
      showToDoList();
    });

    function showToDoList() {
      container.innerHTML = "";

      let token = localStorage.getItem("token");
      title.innerHTML = divHeading;

      for (let i = 0; i < contentArr.length; i++) {

        let content = contentArr[i].text;
        let div = document.createElement("div");
        div.innerHTML = content;
        div.id = i;
        container.appendChild(div);

        let delBtn = document.createElement("button");
        delBtn.className = "button";
        delBtn.innerHTML = "Delete";

        div.appendChild(delBtn);

        delBtn.addEventListener("click", function (evt) {

          contentArr.splice(div.id, 1);
          showToDoList();

        });
      }
    }

    saveBtn.addEventListener("click", async function (evt) {

      let url = "/showToDoList";

      let divHeading = localStorage.getItem("divHeading");
      let token = localStorage.getItem("token");

      let updata = {
        heading: divID,
        body: JSON.stringify(contentArr)
      }

      let cfg = {
        method: "PUT",
        headers: {
          "content-type": "application/json",
          "authorization": token
        },
        body: JSON.stringify(updata)
      };

      try {
        let response = await fetch(url, cfg);
        let data = await response.json();

        if (response.status != 200) {
          throw data.error;
        }

        location.href = "showAllLists.html";

      } catch (error) {
        console.log(error);
      }
    })

    btnShowAllLists.addEventListener("click", async function (evt) {
      location.href = "showAllLists.html";
    });

    showToDoList();

  </script>

  <!---------------- CSS ------------------->

</body>

</html>