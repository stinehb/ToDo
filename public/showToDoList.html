<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ToDoList</title>
</head>
<body>
  <!----------- HTML-elements -------------->

  <h1 id="titel">To Do List</h1><br>
  <input type="text" id="inp"> <button id="itemplus">Legg til en item til denne to do list</button>
  <br>
  |<div id="container"></div>

  <button id="saveBtn">Save</button>

  <!------------- JavaScript --------------->
  <script>

    let container = document.getElementById("container");
    let tittel = document.getElementById("titel");
    let inp = document.getElementById("inp");
    let btnPlusItme = document.getElementById("itemplus");
    let saveBtn = document.getElementById("saveBtn");
    let divHeading = localStorage.getItem("divHeading");
    let divID = localStorage.getItem("divID");
    let divContent = localStorage.getItem("divContent");
    tst = JSON.parse(divContent);
    showToDoList();

    btnPlusItme.addEventListener("click", async function () {

      let todo = {
        text: inp.value,
        id: Date.now(),
      };

      tst.push(todo);
      showToDoList();
    });

    function showToDoList() {
      container.innerHTML = "";

      let token = localStorage.getItem("token");
      tittel.innerHTML = divHeading;
    
      for (let i = 0; i < tst.length; i++) {

        let lol = tst[i].text;
        let div = document.createElement("div");

        div.innerHTML = lol;
        console.log(lol);
        div.id = i;

        let delBtn = document.createElement("button");
        delBtn.innerHTML = "delete item";
        div.appendChild(delBtn);
        container.appendChild(div);

        delBtn.addEventListener("click", function (evt) {

          tst.splice(div, 1);
          showToDoList();

        });


      }
    }

    saveBtn.addEventListener("click", async function (evt) {

      let url = "/showToDoList";

      let divHeading = localStorage.getItem("divHeading");
      let token = localStorage.getItem("token");

      let updata = {
        heading: divID,
        body: JSON.stringify(tst)
      }

      let cfg = {
        method: "PUT",
        headers: {
          "content-type": "application/json",
          "authorization": token
        },
        body: JSON.stringify(updata)
      };

      try {
        let response = await fetch(url, cfg);
        let data = await response.json();

        if (response.status != 200) {
          throw data.error;
        }
      } catch (error) {
        console.log(error);
      }
    })

  </script>

  <!---------------- CSS ------------------->

</body>
</html>