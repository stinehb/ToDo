<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Show Specific To Do List</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!----------- HTML-elements -------------->

  <h1 id="title"></h1><br>
  <div id="container" class="listContainer"></div>
  <input id="inp" type="text">
  <button id="btnNewItem">Add an Item</button>
  <br>


  <button id="btnShowAllLists">Show All Lists</button>

  <!------------- JavaScript --------------->
  <script>

    let container = document.getElementById("container");
    let title = document.getElementById("title");
    let inp = document.getElementById("inp");
    let btnNewItem = document.getElementById("btnNewItem");
    let btnShowAllLists = document.getElementById("btnShowAllLists");

    let divHeading = localStorage.getItem("divHeading");
    let divID = localStorage.getItem("divID");
    let divContent = localStorage.getItem("divContent");
    let data = JSON.parse(divContent);

    function showToDoList() {
      container.innerHTML = "";
      inp.value = "";

      let token = localStorage.getItem("token");
      title.innerHTML = divHeading;

      for (let i = 0; i < data.length; i++) {

        let lol = data[i].text;
        let div = document.createElement("div");

        div.innerHTML = lol;
        div.id = i;

        let delBtn = document.createElement("button");
        delBtn.className = "button";
        delBtn.innerHTML = "Delete";
        container.appendChild(div);
        div.appendChild(delBtn);

        delBtn.addEventListener("click", function (evt) {

          data.splice(div, 1);
          div.removeChild(delBtn);
          updataToDoList();

        });
      }
    }

    async function updataToDoList() {
      let todo = {
        text: inp.value,
        id: Date.now(),
      };

      data.push(todo);

      let url = "/showToDoList";

      let divHeading = localStorage.getItem("divHeading");
      let token = localStorage.getItem("token");

      let updata = {
        heading: divID,
        body: JSON.stringify(data)
      }

      let cfg = {
        method: "PUT",
        headers: {
          "content-type": "application/json",
          "authorization": token
        },
        body: JSON.stringify(updata)
      };

      try {
        let response = await fetch(url, cfg);
        let data = await response.json();

        if (response.status != 200) {
          throw data.error;
        }
      } catch (error) {
        console.log(error);
      }

      showToDoList();
    };

    btnNewItem.addEventListener("click", async function () {
      updataToDoList();
    });

    btnShowAllLists.addEventListener("click", async function (evt) {
      location.href = "showAllLists.html";
    });

    showToDoList();

  </script>
</body>

</html>