<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Show Specific To Do List</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!----------- HTML-elements -------------->

  <h1 id="title"></h1><br>
  <div id="container" class="listContainer"></div>
  <input id="inp" type="text">
  <button id="btnNewItem" class="button">Add an Item</button>
  <br>

  <button id="sendToServer" class="button">Save the List</button>
  <button id="btnShowAllLists" class="button">Show All Lists</button>

  <!------------- JavaScript --------------->
  <script>

    let container = document.getElementById("container");
    let title = document.getElementById("title");
    let inp = document.getElementById("inp");
    let btnNewItem = document.getElementById("btnNewItem");
    let btnShowAllLists = document.getElementById("btnShowAllLists");
    let sendToServer = document.getElementById("sendToServer");

    let divHeading = localStorage.getItem("divHeading");
    let divID = localStorage.getItem("divID");
    let divContent = localStorage.getItem("divContent");
    let data = JSON.parse(divContent);

    function showToDoList() {

      container.innerHTML = "";
      inp.value = "";

      if (data.length < 1) {
        container.innerHTML = "This list have no items";
      }

      let token = localStorage.getItem("token");
      title.innerHTML = divHeading;

      for (let i = 0; i < data.length; i++) {

        let content = data[i].text;
        let div = document.createElement("div");
        div.innerHTML = content;
        div.id = i;


        let delBtn = document.createElement("button");
        delBtn.className = "button";
        delBtn.innerHTML = "Delete";

        div.appendChild(delBtn);
        container.appendChild(div);

        delBtn.addEventListener("click", function (evt) {

          data.splice(div, 1);
          // div.removeChild(delBtn);
          showToDoList();

        });
      }
    }

    async function updateToDoList() {
      // let todo = {
      //   text: inp.value,
      //   id: Date.now(),
      // };

      // data.push(todo);

      let url = "/showToDoList";

      let divHeading = localStorage.getItem("divHeading");
      let token = localStorage.getItem("token");

      let updata = {
        heading: divID,
        body: JSON.stringify(data)
      }

      let cfg = {
        method: "PUT",
        headers: {
          "content-type": "application/json",
          "authorization": token
        },
        body: JSON.stringify(updata)
      };

      try {
        let response = await fetch(url, cfg);
        let data = await response.json();

        if (response.status != 200) {
          throw data.error;
        }
      } catch (error) {
        console.log(error);
      }

      // showToDoList();
    };

    btnNewItem.addEventListener("click", async function () {
      updateToDoList();
    });

    sendToServer.addEventListener("click", async function () {
      updateToDoList();
    });

    btnShowAllLists.addEventListener("click", async function (evt) {
      location.href = "showAllLists.html";
    });

    showToDoList();

  </script>
</body>

</html>